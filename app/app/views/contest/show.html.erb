<div class="contest-page">
  <!-- Header Section -->
  <div class="contest-header">
    <h1 class="contest-title"><%= @contest.name %></h1>
    
    <div class="contest-meta">
      <div class="contest-badge <%= @contest.active? ? 'active' : @contest.upcoming? ? 'upcoming' : 'ended' %>">
        <%= @contest.active? ? 'Active' : @contest.upcoming? ? 'Upcoming' : 'Ended' %>
      </div>
      
      <div class="contest-time-info">
        <span class="time-icon">ğŸ“…</span>
        <span><%= @contest.start_time.strftime("%b %d, %Y %I:%M %p") %> - <%= @contest.end_time.strftime("%b %d, %Y %I:%M %p") %></span>
      </div>
      
      <div class="contest-time-info">
        <span class="time-icon">â±ï¸</span>
        <span><%= @contest.duration_minutes %> minutes</span>
      </div>
    </div>
    
    <!-- Action Buttons -->
    <div class="contest-actions">
      <% if @is_participant %>
        <div class="participant-badge">
          <span>âœ“ You are registered</span>
        </div>
      <% elsif @access_service.can_join? %>
        <%= form_with url: join_contest_path(@contest), method: :post, data: { turbo: false } do |f| %>
          <%= f.submit "Register", class: "btn btn-primary btn-large" %>
        <% end %>
      <% end %>
      
      <% if @contest.active? || @contest.ended? %>
        <%= link_to "Standings", standings_contest_path(@contest), class: "btn btn-secondary", data: { turbo: false } %>
        <%= link_to "My Submissions", submissions_contest_path(@contest), class: "btn btn-secondary", data: { turbo: false } %>
      <% end %>
    </div>
  </div>

  <!-- Contest Description -->
  <% if @contest.description.present? %>
    <div class="contest-card">
      <h2 class="card-title">About</h2>
      <div class="card-content">
        <%= simple_format(@contest.description) %>
      </div>
    </div>
  <% end %>

  <!-- Contest Rules -->
  <% if @contest.rules.present? %>
    <div class="contest-card">
      <h2 class="card-title">Rules</h2>
      <div class="card-content">
        <%= simple_format(@contest.rules) %>
      </div>
    </div>
  <% end %>

  <!-- Contest Info -->
  <div class="contest-card">
    <h2 class="card-title">Contest Details</h2>
    <div class="contest-info-grid">
      <div class="info-item">
        <span class="info-label">Start Time</span>
        <span class="info-value"><%= @contest.start_time.strftime("%B %d, %Y at %I:%M %p") %></span>
      </div>
      <div class="info-item">
        <span class="info-label">End Time</span>
        <span class="info-value"><%= @contest.end_time.strftime("%B %d, %Y at %I:%M %p") %></span>
      </div>
      <div class="info-item">
        <span class="info-label">Duration</span>
        <span class="info-value"><%= @contest.duration_minutes %> minutes</span>
      </div>
      <div class="info-item">
        <span class="info-label">Penalty</span>
        <span class="info-value"><%= @contest.penalty_minutes %> minutes per wrong submission</span>
      </div>
    </div>
  </div>

  <!-- Problems List -->
  <% if (@contest.active? || @contest.ended? || current_user.admin?) && @problems.any? %>
    <div class="contest-card">
      <h2 class="card-title">Problems</h2>
      <table class="contest-problems-table">
        <thead>
          <tr>
            <th style="width: 80px;">ID</th>
            <th>Title</th>
            <th class="center" style="width: 120px;">Difficulty</th>
            <% if @is_participant && (@contest.active? || @contest.ended?) %>
              <th class="center" style="width: 100px;">Status</th>
            <% end %>
          </tr>
        </thead>
        <tbody>
          <% @problems.each do |problem| %>
            <tr onclick="window.location='<%= problem_path(problem) %>'">
              <td class="center problem-id" data-label="ID"><%= problem.id %></td>
              <td class="problem-title-cell" data-label="Title">
                <%= link_to problem.title, problem_path(problem), data: { turbo: false } %>
              </td>
              <td class="center" data-label="Difficulty">
                <span class="problem-difficulty-badge <%= problem.difficulty %>">
                  <%= problem.difficulty.capitalize %>
                </span>
              </td>
              <% if @is_participant && (@contest.active? || @contest.ended?) %>
                <td class="center" data-label="Status">
                  <% if current_user %>
                    <% user_status = problem.user_problem_statuses.find_by(user: current_user) %>
                    <% if user_status&.status == 'solved' %>
                      <span class="problem-status-badge solved">âœ“ Solved</span>
                    <% elsif user_status&.status == 'attempted' %>
                      <span class="problem-status-badge attempted">â—‹ Attempted</span>
                    <% else %>
                      <span class="problem-status-badge unattempted">â€”</span>
                    <% end %>
                  <% end %>
                </td>
              <% end %>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% elsif @contest.upcoming? && !current_user.admin? %>
    <div class="contest-card">
      <div class="info-message">
        ğŸ“‹ Problems will be revealed when the contest starts.
      </div>
    </div>
  <% elsif @contest.ended? %>
    <div class="contest-card">
      <div class="info-message">
        This contest has ended. You can view the standings and problems.
      </div>
    </div>
  <% end %>
</div>
