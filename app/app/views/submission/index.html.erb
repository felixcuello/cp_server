<div class="page-container submissions-page">
  <!-- Header -->
  <div class="submissions-header">
    <h1 class="page-title"><%= @show_all ? "All Submissions" : "My Submissions" %></h1>
    <div class="header-actions">
      <% if @show_all %>
        <%= link_to submission_path, class: "toggle-view-btn" do %>
          <span>ğŸ‘¤</span>
          <span>My Submissions</span>
        <% end %>
      <% else %>
        <%= link_to submission_path(show_all: 'true'), class: "toggle-view-btn" do %>
          <span>ğŸ‘¥</span>
          <span>All Users</span>
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Filters Section (always visible) -->
  <div class="submissions-filters-panel">
    <%= form_with url: submission_path, method: :get, class: "filter-form", data: { turbo: false } do |f| %>
      <%= hidden_field_tag :show_all, @show_all ? 'true' : nil %>
      
      <div class="filter-grid">
        <div class="filter-item">
          <label class="filter-label">Result</label>
          <%= select_tag :status, 
              options_for_select([['All Results', 'all']] + @statuses.map { |s| [s.titleize, s] }, params[:status] || 'all'),
              class: 'filter-select' %>
        </div>

        <div class="filter-item">
          <label class="filter-label">Problem</label>
          <%= select_tag :problem,
              options_for_select([['All Problems', 'all']] + @all_problems.map { |p| ["#{p.id}. #{p.title}", p.id] }, params[:problem] || 'all'),
              class: 'filter-select' %>
        </div>

        <div class="filter-item">
          <label class="filter-label">Language</label>
          <%= select_tag :language,
              options_for_select([['All Languages', 'all']] + @all_languages.map { |l| [l.name, l.id] }, params[:language] || 'all'),
              class: 'filter-select' %>
        </div>

        <% if @all_contests %>
          <div class="filter-item">
            <label class="filter-label">Contest</label>
            <%= select_tag :contest_id,
                options_for_select([['All Contests', 'all']] + @all_contests.map { |c| [c.name, c.id] }, params[:contest_id] || 'all'),
                class: 'filter-select' %>
          </div>
        <% end %>
        
        <% if @show_all %>
          <div class="filter-item">
            <label class="filter-label">User</label>
            <%= select_tag :user_id,
                options_for_select([['All Users', 'all']] + @all_users.map { |u| [u.alias, u.id] }, params[:user_id] || 'all'),
                class: 'filter-select' %>
          </div>
        <% end %>
        
        <div class="filter-item">
          <label class="filter-label">Time Range</label>
          <%= select_tag :time_range,
              options_for_select([
                ['All Time', 'all'],
                ['Today', 'today'],
                ['This Week', 'week'],
                ['This Month', 'month']
              ], params[:time_range] || 'all'),
              class: 'filter-select' %>
        </div>
      </div>

      <div class="filter-actions">
        <%= submit_tag "Apply Filters", class: "btn-apply" %>
        <%= link_to "Clear Filters", submission_path(show_all: @show_all ? 'true' : nil, contest_id: params[:contest_id]), class: "btn-clear" %>
      </div>
    <% end %>
  </div>

  <!-- Results Info -->
  <div class="submissions-info-bar">
    <span class="results-count">
      Showing <strong><%= @submissions.count %></strong> of <strong><%= @total_count %></strong> submissions
    </span>
    <% if params[:status].present? || params[:language].present? || params[:problem].present? || params[:my_submissions] == 'true' %>
      <span class="filtered-badge">Filtered</span>
    <% end %>
  </div>

  <!-- Submissions List -->
  <div class="submissions-list">
    <% if @submissions.any? %>
      <% @submissions.each do |submission| %>
        <div class="submission-card"
             onclick="window.location='<%= submission_detail_path(submission) %>'"
             data-controller="submission-status"
             data-submission-status-id-value="<%= submission.id %>"
             data-submission-status-current-value="<%= submission.status %>">
          
          <!-- Top Row: Problem + Status -->
          <div class="submission-card-header">
            <div class="submission-problem-info">
              <span class="problem-number">#<%= submission.problem.id %></span>
              <%= link_to submission.problem.title, problem_path(submission.problem), class: "problem-title-link", data: { turbo: false } %>
              <% if submission.contest %>
                <span class="contest-badge-small" title="Contest: <%= submission.contest.name %>">
                  ğŸ† Contest
                </span>
              <% end %>
            </div>
            <div class="submission-status-badge <%= submission.status.downcase.gsub(/\s+/, '-') %>">
              <%= status_icon(submission.status) %>
              <span><%= submission.status.titleize %></span>
            </div>
          </div>

          <!-- Bottom Row: Meta info -->
          <div class="submission-card-footer">
            <div class="submission-meta">
              <span class="meta-item">
                <span class="meta-icon">ğŸ‘¤</span>
                <%= link_to submission.user.alias, user_path(alias: submission.user.alias), class: "user-link", onclick: "event.stopPropagation();" %>
              </span>
              <span class="meta-item">
                <span class="meta-icon">ğŸ’»</span>
                <span class="language-name"><%= submission.programming_language.name %></span>
              </span>
              <span class="meta-item">
                <span class="meta-icon">â±ï¸</span>
                <span class="time-text"><%= time_ago_in_words(submission.created_at) %> ago</span>
              </span>
              <% if submission.time_used %>
                <span class="meta-item">
                  <span class="meta-icon">âš¡</span>
                  <span class="runtime-text"><%= (submission.time_used * 1000).round %> ms</span>
                </span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="empty-state">
        <div class="empty-icon">ğŸ“</div>
        <div class="empty-title">No submissions found</div>
        <% if params[:status].present? || params[:language].present? || params[:problem].present? %>
          <div class="empty-text">Try adjusting your filters or clearing them</div>
        <% else %>
          <div class="empty-text">Start solving problems to see your submissions here</div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Pagination -->
  <% if @total_pages > 1 %>
    <div class="pagination-container">
      <% if @page > 1 %>
        <%= link_to submission_path(params.permit(:status, :language, :problem, :my_submissions, :contest_id, :show_all).merge(page: @page - 1)), class: "pagination-btn" do %>
          <span>â† Previous</span>
        <% end %>
      <% else %>
        <span class="pagination-btn disabled">â† Previous</span>
      <% end %>

      <div class="pagination-info">
        Page <strong><%= @page %></strong> of <strong><%= @total_pages %></strong>
      </div>

      <% if @page < @total_pages %>
        <%= link_to submission_path(params.permit(:status, :language, :problem, :my_submissions, :contest_id, :show_all).merge(page: @page + 1)), class: "pagination-btn" do %>
          <span>Next â†’</span>
        <% end %>
      <% else %>
        <span class="pagination-btn disabled">Next â†’</span>
      <% end %>
    </div>
  <% end %>
</div>
