<div class="page-container submissions-page">
  <!-- Header -->
  <div class="submissions-header">
    <h1 class="page-title">Submissions</h1>
    <button class="filter-toggle-btn" data-controller="submission-filters" data-action="click->submission-filters#toggle">
      <span class="filter-icon">ğŸ”</span>
      <span>Filters</span>
    </button>
  </div>

  <!-- Filters Section (collapsible) -->
  <div class="submissions-filters-panel" data-submission-filters-target="panel" style="display: none;">
    <%= form_with url: submission_path, method: :get, class: "filter-form", data: { turbo: false } do |f| %>
      <div class="filter-grid">
        <div class="filter-item">
          <label class="filter-label">Status</label>
          <%= select_tag :status, 
              options_for_select([['All Statuses', 'all']] + @statuses.map { |s| [s.titleize, s] }, params[:status] || 'all'),
              class: 'filter-select' %>
        </div>

        <div class="filter-item">
          <label class="filter-label">Language</label>
          <%= select_tag :language,
              options_for_select([['All Languages', 'all']] + @all_languages.map { |l| [l.name, l.id] }, params[:language] || 'all'),
              class: 'filter-select' %>
        </div>

        <div class="filter-item">
          <label class="filter-label">Problem</label>
          <%= select_tag :problem,
              options_for_select([['All Problems', 'all']] + @all_problems.map { |p| ["#{p.id}. #{p.title}", p.id] }, params[:problem] || 'all'),
              class: 'filter-select' %>
        </div>

        <% if current_user %>
          <div class="filter-item filter-checkbox-item">
            <label class="checkbox-container">
              <%= check_box_tag :my_submissions, 'true', params[:my_submissions] == 'true', class: 'filter-checkbox' %>
              <span class="checkbox-label">My submissions only</span>
            </label>
          </div>
        <% end %>
      </div>

      <div class="filter-actions">
        <%= submit_tag "Apply Filters", class: "btn-apply" %>
        <%= link_to "Clear", submission_path, class: "btn-clear" %>
      </div>
    <% end %>
  </div>

  <!-- Results Info -->
  <div class="submissions-info-bar">
    <span class="results-count">
      Showing <strong><%= @submissions.count %></strong> of <strong><%= @total_count %></strong> submissions
    </span>
    <% if params[:status].present? || params[:language].present? || params[:problem].present? || params[:my_submissions] == 'true' %>
      <span class="filtered-badge">Filtered</span>
    <% end %>
  </div>

  <!-- Submissions List -->
  <div class="submissions-list">
    <% if @submissions.any? %>
      <% @submissions.each do |submission| %>
        <div class="submission-card"
             onclick="window.location='<%= submission_detail_path(submission) %>'"
             data-controller="submission-status"
             data-submission-status-id-value="<%= submission.id %>"
             data-submission-status-current-value="<%= submission.status %>">
          
          <!-- Top Row: Problem + Status -->
          <div class="submission-card-header">
            <div class="submission-problem-info">
              <span class="problem-number">#<%= submission.problem.id %></span>
              <%= link_to submission.problem.title, problem_path(submission.problem), class: "problem-title-link" %>
            </div>
            <div class="submission-status-badge <%= submission.status.downcase.gsub(/\s+/, '-') %>">
              <%= status_icon(submission.status) %>
              <span><%= submission.status.titleize %></span>
            </div>
          </div>

          <!-- Bottom Row: Meta info -->
          <div class="submission-card-footer">
            <div class="submission-meta">
              <span class="meta-item">
                <span class="meta-icon">ğŸ‘¤</span>
                <%= link_to submission.user.alias, user_path(alias: submission.user.alias), class: "user-link", onclick: "event.stopPropagation();" %>
              </span>
              <span class="meta-item">
                <span class="meta-icon">ğŸ’»</span>
                <span class="language-name"><%= submission.programming_language.name %></span>
              </span>
              <span class="meta-item">
                <span class="meta-icon">â±ï¸</span>
                <span class="time-text"><%= time_ago_in_words(submission.created_at) %> ago</span>
              </span>
              <% if submission.time_used %>
                <span class="meta-item">
                  <span class="meta-icon">âš¡</span>
                  <span class="runtime-text"><%= (submission.time_used * 1000).round %> ms</span>
                </span>
              <% end %>
            </div>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="empty-state">
        <div class="empty-icon">ğŸ“</div>
        <div class="empty-title">No submissions found</div>
        <% if params[:status].present? || params[:language].present? || params[:problem].present? %>
          <div class="empty-text">Try adjusting your filters or clearing them</div>
        <% else %>
          <div class="empty-text">Start solving problems to see your submissions here</div>
        <% end %>
      </div>
    <% end %>
  </div>

  <!-- Pagination -->
  <% if @total_pages > 1 %>
    <div class="pagination-container">
      <% if @page > 1 %>
        <%= link_to submission_path(params.permit(:status, :language, :problem, :my_submissions).merge(page: @page - 1)), class: "pagination-btn" do %>
          <span>â† Previous</span>
        <% end %>
      <% else %>
        <span class="pagination-btn disabled">â† Previous</span>
      <% end %>

      <div class="pagination-info">
        Page <strong><%= @page %></strong> of <strong><%= @total_pages %></strong>
      </div>

      <% if @page < @total_pages %>
        <%= link_to submission_path(params.permit(:status, :language, :problem, :my_submissions).merge(page: @page + 1)), class: "pagination-btn" do %>
          <span>Next â†’</span>
        <% end %>
      <% else %>
        <span class="pagination-btn disabled">Next â†’</span>
      <% end %>
    </div>
  <% end %>
</div>
