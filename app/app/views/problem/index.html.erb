<div class="page-container" data-controller="problem-search problem-filter pagination" data-pagination-per-page-value="20">
  <!-- Header with Search -->
  <div class="problem-list-header">
    <h1 class="problem-list-title-new"><%= t('problems.title') %></h1>
    
    <div class="problem-search-box">
      <input 
        type="text" 
        placeholder="<%= t('problems.search_placeholder') %>" 
        data-problem-search-target="input"
        data-action="input->problem-search#search">
      <button class="search-clear" data-action="click->problem-search#clear">
        <%= t('problems.clear') %>
      </button>
    </div>
  </div>
  
  <!-- Filter Sidebar + Table Layout -->
  <div class="content-wrapper">
    <!-- Left Sidebar for Filters -->
    <aside class="sidebar">
      <div class="sidebar-section">
        <h3 class="sidebar-title"><%= t('problems.difficulty') %></h3>
        <div class="sidebar-difficulty-pills">
          <% ['easy', 'medium', 'hard'].each do |diff| %>
            <label class="sidebar-difficulty-pill sidebar-difficulty-pill--<%= diff %>">
              <input 
                type="checkbox" 
                value="<%= diff %>"
                style="display: none;"
                data-problem-filter-target="difficultyCheckbox"
                data-action="change->problem-filter#filter">
              <%= t("problems.filters.#{diff}") %>
            </label>
          <% end %>
        </div>
      </div>
      
      <div class="sidebar-divider"></div>
      
      <div class="sidebar-section">
        <h3 class="sidebar-title"><%= t('problems.status') %></h3>
        <div class="sidebar-filter-group">
          <label class="sidebar-filter-item">
            <input 
              type="checkbox" 
              value="solved"
              data-problem-filter-target="statusCheckbox"
              data-action="change->problem-filter#filter">
            <span><%= t('problems.filters.solved') %></span>
          </label>
          <label class="sidebar-filter-item">
            <input 
              type="checkbox" 
              value="attempted"
              data-problem-filter-target="statusCheckbox"
              data-action="change->problem-filter#filter">
            <span><%= t('problems.filters.attempted') %></span>
          </label>
          <label class="sidebar-filter-item">
            <input 
              type="checkbox" 
              value="unattempted"
              data-problem-filter-target="statusCheckbox"
              data-action="change->problem-filter#filter">
            <span><%= t('problems.filters.not_attempted') %></span>
          </label>
        </div>
      </div>
      
      <div class="sidebar-divider"></div>
      
      <div class="sidebar-section">
        <h3 class="sidebar-title"><%= t('problems.tags') %></h3>
        <div class="sidebar-tag-list">
          <% @all_tags.each do |tag| %>
            <label class="sidebar-tag">
              <input 
                type="checkbox" 
                value="<%= tag.name %>" 
                style="display: none;"
                data-problem-filter-target="tagCheckbox"
                data-action="change->problem-filter#filter">
              <%= tag.name %>
            </label>
          <% end %>
        </div>
      </div>
      
      <div class="sidebar-divider"></div>
      
      <button 
        class="sidebar-clear-filters" 
        data-problem-filter-target="clearButton"
        data-action="click->problem-filter#clearAll"
        style="display: none;">
        <%= t('problems.clear_all_filters') %>
      </button>
    </aside>
    
    <!-- Main Content: Problem Table -->
    <div class="main-content">
      <table class="problems-table">
        <thead>
          <tr>
            <th class="center" style="width: 60px;"><%= t('problems.table.status') %></th>
            <th><%= t('problems.table.title') %></th>
            <th class="center hide-mobile sortable" style="width: 120px;"><%= t('problems.table.acceptance') %></th>
            <th class="center" style="width: 100px;"><%= t('problems.table.difficulty') %></th>
            <th class="hide-mobile"><%= t('problems.table.tags') %></th>
          </tr>
        </thead>
        <tbody>
          <% @problems.each do |problem| %>
            <%
              user_status = current_user ? problem.user_problem_statuses.find_by(user: current_user) : nil
              status_class = if user_status&.status == 'solved'
                              'solved'
                             elsif user_status&.status == 'attempted'
                              'attempted'
                             else
                              'unattempted'
                             end
              status_icon = case status_class
                           when 'solved' then '✓'
                           when 'attempted' then '○'
                           else '—'
                           end
              
              acceptance = problem.acceptance_rate
              acceptance_class = if acceptance >= 50
                                  'high'
                                elsif acceptance >= 30
                                  'medium'
                                else
                                  'low'
                                end
              
              tag_names = problem.tags.map(&:name).join(',')
            %>
            <tr 
              data-problem-search-target="row"
              data-problem-filter-target="row"
              data-pagination-target="row"
              data-problem-id="<%= problem.id %>"
              data-problem-title="<%= problem.title %>"
              data-problem-difficulty="<%= problem.difficulty %>"
              data-problem-status="<%= status_class %>"
              data-problem-tags="<%= tag_names %>"
              onclick="window.location='<%= problem_path(problem) %>'">
              
              <td class="center">
                <span class="problem-status <%= status_class %>">
                  <%= status_icon %>
                </span>
              </td>
              
              <td class="problem-title-cell">
                <%= link_to problem_path(problem), data: { turbo: false } do %>
                  <strong><%= problem.id %>.</strong> <%= problem.translated_title %>
                <% end %>
              </td>
              
              <td class="center hide-mobile">
                <span class="acceptance-rate <%= acceptance_class %>">
                  <%= acceptance %>%
                </span>
              </td>
              
              <td class="center">
                <span class="problem-difficulty-<%= problem.difficulty %>">
                  <%= t("problems.filters.#{problem.difficulty}") %>
                </span>
              </td>
              
              <td class="hide-mobile">
                <% problem.tags.first(3).each do |tag| %>
                  <span class="problem-tag"><%= tag.name %></span>
                <% end %>
                <% if problem.tags.count > 3 %>
                  <span style="color: var(--text-secondary); font-size: 0.9em;">
                    +<%= problem.tags.count - 3 %>
                  </span>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
      
      <% if @problems.empty? %>
        <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
          <p style="font-size: 1.2em;"><%= t('problems.no_problems') %></p>
        </div>
      <% end %>
      
      <!-- Pagination Controls -->
      <% if @problems.any? %>
        <div class="pagination-controls">
          <div class="pagination-info" data-pagination-target="info"></div>
          <div class="pagination-nav">
            <button 
              class="pagination-btn" 
              data-pagination-target="prevButton"
              data-action="click->pagination#prev"
              disabled>
              ← <%= t('problems.pagination.prev', default: 'Previous') %>
            </button>
            <div class="pagination-pages" data-pagination-target="pageNumbers"></div>
            <button 
              class="pagination-btn" 
              data-pagination-target="nextButton"
              data-action="click->pagination#next">
              <%= t('problems.pagination.next', default: 'Next') %> →
            </button>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>
